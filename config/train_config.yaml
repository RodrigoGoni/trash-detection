# Object Detection Training Configuration

# Experiment settings
experiment:
  name: "taco_detection_baseline"
  tags:
    - "no_augmentation"
    - "modern_config"
    - "adamw_optimizer"
    - "cosine_scheduler"
    - "faster_rcnn"
    - "resnet50"
  description: "Faster R-CNN baseline WITHOUT augmentation (only letterbox) for TACO object detection"

# Data settings
data:
  processed_dir: "./data/processed"
  batch_size: 16
  num_workers: 20
  img_size: 640
  dataset_version: "v1.0"  # Track dataset version
  
  # Preprocessing parameters (will be logged to MLflow)
  preprocessing:
    normalize: true
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]
    bbox_format: "pascal_voc"
  
  # Augmentation parameters for train set
  # BASELINE: All augmentations disabled (set to 0.0)
  # Enable gradually after baseline training
  augmentation:
    # Geometric augmentations
    horizontal_flip_p: 0.0
    vertical_flip_p: 0.0
    shift_scale_rotate_p: 0.0
    shift_limit: 0.0
    scale_limit: 0.0
    rotate_limit: 0
    
    # Photometric augmentations
    brightness_contrast_p: 0.0
    brightness_limit: 0.0
    contrast_limit: 0.0
    
    hue_saturation_p: 0.0
    hue_shift_limit: 0
    sat_shift_limit: 0
    val_shift_limit: 0
    
    # Blur augmentations
    blur_p: 0.0
    blur_limit: 3
    
    # Noise augmentations
    noise_p: 0.0
    
    # Cutout/dropout augmentations
    cutout_p: 0.0
    cutout_max_holes: 0
    cutout_max_height: 0
    cutout_max_width: 0

# Model settings
model:
  name: "FasterRCNN"
  backbone: "resnet50"
  pretrained: true
  num_classes: 61  # 60 classes + 1 background

# Training settings
training:
  num_epochs: 50
  device: "cuda"
  
  # Optimizer - AdamW (modern best practice for vision)
  optimizer:
    type: "adamw"              # AdamW with decoupled weight decay
    lr: 0.0001                 # Lower LR for AdamW (typical: 1e-4 to 1e-3)
    betas: [0.9, 0.999]        # Adam betas (momentum-like parameters)
    weight_decay: 0.01         # L2 regularization (decoupled in AdamW)
    eps: 0.00000001            # Numerical stability (1e-8)
  
  # Scheduler - Cosine Annealing with Warmup (modern best practice)
  scheduler:
    type: "cosine_annealing_warmup"  # Smooth decay to 0
    warmup_epochs: 5                 # Linear warmup for first 5 epochs
    min_lr: 0.000001                 # Minimum learning rate at end (1e-6)
    # Cosine annealing will smoothly reduce LR from initial to min_lr
  
  # Mixed Precision Training (for faster training and less memory)
  use_amp: true                # Automatic Mixed Precision (FP16)
  
  # Gradient Clipping (prevent exploding gradients)
  grad_clip_norm: 1.0          # Clip gradients to max norm of 1.0
  
  # Checkpointing
  save_dir: "./models/checkpoints"
  save_best_only: true
  
  # Validation
  val_frequency: 1  # Validate every N epochs
  
  # Early stopping
  patience: 15                 # Increased patience for cosine annealing

# MLflow settings
mlflow:
  tracking_uri: "./mlruns"
  experiment_name: "taco-object-detection"
  log_model: true
  log_artifacts: true
