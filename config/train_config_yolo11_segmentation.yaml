# Experiment settings
experiment:
  name: "taco_segmentation_yolo11x_23x_baseline"
  tags:
    - "yolo11"
    - "yolo11x-seg"
    - "instance_segmentation"
    - "aug"
    - "adamw_optimizer"
    - "cosine_scheduler"
  description: "YOLOv11-medium-seg aug for TACO dataset instance segmentation"

# Data settings
data:
  processed_dir: "./data/yolo_seg"
  batch_size: 4
  num_workers: 12
  img_size: 1280
  dataset_version: "v1.0"

# Model settings
model:
  name: "YOLOv11-seg"
  model_size: "x"  # Options: 'n', 's', 'm', 'l', 'x'
  pretrained: true  # Usa pesos pre-entrenados en COCO-seg
  num_classes: 23  # Number of classes (YOLO doesn't use background class)

# Training settings (basic parameters)
training:
  num_epochs: 500
  device: "cuda"

# ============================================================
# YOLO-SPECIFIC TRAINING PARAMETERS FOR SEGMENTATION
# ============================================================
# Estos parámetros se pasan directamente a YOLO durante el entrenamiento
# Ref: https://docs.ultralytics.com/modes/train/
yolo_training:
  # ============================================================
  # TRAINING BEHAVIOR
  # ============================================================
  dropout: 0.0                 # Dropout rate for regularization (0.0-0.5)
  val: true                    # Enable validation during training
  plots: true                  # Generate and save training plots
  save: true                   # Save checkpoints
  
  # ============================================================
  # LEARNING RATE & OPTIMIZATION
  # ============================================================
  optimizer: 'AdamW'           # Options: SGD, Adam, AdamW, NAdam, RAdam, RMSProp, auto
  lr0: 0.001                   # Initial LR (SGD=1E-2, Adam/AdamW=1E-3)
  lrf: 0.01                    # Final LR as fraction of lr0
  momentum: 0.937              # Momentum for SGD or beta1 for Adam
  weight_decay: 0.0005         # L2 regularization
  
  # ============================================================
  # LEARNING RATE SCHEDULING
  # ============================================================
  cos_lr: true                 # Use cosine learning rate scheduler
  warmup_epochs: 50          # Number of warmup epochs
  warmup_momentum: 0.8         # Initial momentum during warmup
  warmup_bias_lr: 0.1          # Bias learning rate during warmup
  
  # ============================================================
  # LOSS WEIGHTS
  # ============================================================
  box: 7.5                     # Box loss weight (default: 7.5)
  cls: 0.5                     # Classification loss weight (default: 0.5)
  dfl: 1.5                     # Distribution focal loss weight (default: 1.5)
  
  # ============================================================
  # SEGMENTATION-SPECIFIC PARAMETERS
  # ============================================================
  # Estos parámetros son específicos para instance segmentation
  overlap_mask: true           # Masks should overlap during training (default: true)
  mask_ratio: 1                # Mask downsample ratio (default: 4)
                               # Menor ratio = mayor resolución de máscaras (más memoria)
                               # Para objetos pequeños considerar mask_ratio: 2 o 1
  
  # ============================================================
  # TRAINING STRATEGY
  # ============================================================
  seed: 0                      # Random seed for reproducibility
  deterministic: false         # Force deterministic algorithms
  single_cls: false            # Treat multi-class as single class
  classes: null                # List of class IDs to train on (null = all classes)
  rect: false                  # Rectangular training (minimum padding strategy)
  compile: false               # PyTorch 2.x torch.compile (experimental)
  close_mosaic: 200             # Disable mosaic in last N epochs
  resume: false                # Resume from last checkpoint if it exists
  patience: 200                # Early stopping patience (epochs without improvement)
  
  # ============================================================
  # DATA AUGMENTATION (YOLO-specific)
  # ============================================================
  augmentation:
    # Color augmentations
    hsv_h: 0.01               # HSV Hue augmentation (0.0-1.0)
    hsv_s: 0.3                # HSV Saturation augmentation (0.0-1.0)
    hsv_v: 0.4                 # HSV Value augmentation (0.0-1.0)
    
    # Geometric augmentations
    degrees: 45              # Image rotation (+/- degrees)
    translate: 0.25            # Image translation (+/- fraction)
    scale: 0.5                # Image scale (+/- gain)
    shear: 5                 # Image shear (+/- degrees)
    perspective: 0.0000       # Perspective transformation (0.0-0.001)
    
    # Flip augmentations
    flipud: 0.5                # Vertical flip probability (0.0-1.0)
    fliplr: 0.5               # Horizontal flip probability (0.0-1.0)
    
    # Advanced augmentations
    mosaic: 1.0               # Mosaic augmentation probability (0.0-1.0)
    mixup: 0.1                 # Mixup augmentation probability (0.0-1.0)
    copy_paste: 0.5            # Copy-paste augmentation probability (0.0-1.0)
    cutmix: 0.1
    erasing: 0.3

# MLflow settings
mlflow:
  tracking_uri: "./mlruns"
  experiment_name: "taco-yolo-segmentation"
  log_model: true
  log_artifacts: true

# ============================================================
# POST-PROCESSING THRESHOLDS (para inferencia/evaluación)
# ============================================================
inference:
  conf_threshold: 0.25         # Confidence threshold for predictions
  iou_threshold: 0.7           # IoU threshold for NMS
